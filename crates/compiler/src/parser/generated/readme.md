# ANTLR files

All files in this directory were autogenerated by ANTLR with minimal manual adjustments.

## Autogeneration

- Download [this custom ANTLR](https://github.com/rrevenantt/antlr4rust/releases/tag/antlr4-4.8-2-Rust0.3.0-beta)
  provided by antlr4rust.
- `cd` into the root of this repo: `cd path/to/yarnspinner`
- Download the third-party submodules: `git submodule update --init --recursive`
- Run the following command: 
> `java -jar "path/to/antlr4-4.8-2-SNAPSHOT-complete.jar" -Dlanguage=Rust third-party/YarnSpinner/YarnSpinner.Compiler/*.g4 -visitor -Xexact-output-dir -o crates/compiler/src/parser/generated`

## Manual Adjustments

* Rename `YarnSpinnerParserParserContext` to `YarnSpinnerParserContext`
    * Something goes wrong during generation with this type, resulting in the
      error `symbol type conflicts with generated code in target language or runtime`
* Add the generated `mod`s to `generated.rs`, including lint allow attributes for `warnings`, `clippy` and `rustfmt`
* Disambiguate `visit_node` by explicitly using `antlr_rust::tree::VisitChildren::visit_node` (other variant would be `yarnspinnerparservisitor::YarnSpinnerParserVisitor::visit_node`)
* Replace `antlr_rust::tree::VisitChildren::visit_node(visitor, self);` by `YarnSpinnerParserVisitor::visit_node(visitor, self);`. The issue there is that `node` already means something in the
ANTLR world, thus there is an ambiguity when calling `visit_node`, which antlr4rust resolved the wrong way here, resulting in an infinite recursion
* Add the `new_with_text` function to allow creating a context with a specific text, which is possible in the C# version of ANTLR.
